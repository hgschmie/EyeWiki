<?xml version="1.0" encoding="UTF-8"?>

<!-- ======================================================================== -->
<!--                                                                          -->
<!--  maven Buildfile                                                         -->
<!--                                                                          -->
<!-- $Id: maven.xml 2360 2004-08-03 10:38:25Z henning $ -->
<!--                                                                          -->
<!-- ======================================================================== -->

<project
  xmlns:j="jelly:core"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"
  default="jar:jar">

  <postGoal name="war:webapp">
    <!-- Copy Properties File -->
    <ant:copy file="etc/jspwiki.properties.tmpl" tofile="${maven.war.webapp.dir}/WEB-INF/jspwiki.properties" />
    <ant:replace file="${maven.war.webapp.dir}/WEB-INF/jspwiki.properties"
               replacefilterfile="build.properties"/>

    <!-- Copy TagLibs Files -->
    <ant:copy todir="${maven.war.webapp.dir}/WEB-INF" >
      <ant:fileset dir="etc">
        <include name="**/*.tld"/>
      </ant:fileset>
    </ant:copy>

    <!-- copy wiki pages -->
    <ant:copy todir="${maven.war.webapp.dir}/jspwiki/pages" >
      <ant:fileset dir="src/wikipages">
        <include name="**/*"/>
      </ant:fileset>
    </ant:copy>

    <ant:mkdir dir="${maven.war.webapp.dir}/jspwiki/work" />
    <ant:mkdir dir="${maven.war.webapp.dir}/jspwiki/logs" />

  </postGoal>

  <preGoal name="test:test-resources">
    <ant:mkdir dir="${maven.build.dir}/tests" />

    <ant:copy file="src/test/etc/TextFormattingRules.txt" tofile="${maven.build.dir}/test-classes/TextFormattingRules.txt" />
    <ant:copy file="src/test/etc/TestPlugins.txt" tofile="${maven.build.dir}/test-classes/TestPlugins.txt" />

    <ant:copy file="src/test/etc/jspwiki.properties.tmpl" tofile="${maven.build.dir}/test-classes/jspwiki.properties" />
    <ant:copy file="src/test/etc/jspwiki_rcs.properties.tmpl" tofile="${maven.build.dir}/test-classes/jspwiki_rcs.properties" />
    <ant:copy file="src/test/etc/jspwiki_vers.properties.tmpl" tofile="${maven.build.dir}/test-classes/jspwiki_vers.properties" />
    <ant:replace file="${maven.build.dir}/test-classes/jspwiki.properties"
               replacefilterfile="build.properties"/>
    <ant:replace file="${maven.build.dir}/test-classes/jspwiki_rcs.properties"
               replacefilterfile="build.properties"/>
    <ant:replace file="${maven.build.dir}/test-classes/jspwiki_vers.properties"
               replacefilterfile="build.properties"/>

  </preGoal>

  <goal name="deploy">
    <j:if test="${context.getVariable('maven.appserver.home') == null || context.getVariable('maven.appserver.home') == ''}">
        <fail>
 -----------------------------------------------------------------
| Configuration Error                                             |
 -----------------------------------------------------------------

 You must define maven.appserver.home!

------------------------------------------------------------------
        </fail>
    </j:if>

    <attainGoal name="war:webapp"/>
    <echo>Installing to Appserver Directory: ${maven.appserver.home}</echo>

    <ant:copy todir="${maven.appserver.home}/webapps/${pom.artifactId}" filtering="false">
      <ant:fileset dir="${maven.war.webapp.dir}"/>
    </ant:copy>
  </goal>

</project>


